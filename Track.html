<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: Arial; padding: 20px; }
      label { display: block; margin-top: 10px; }
      input, button { padding: 5px; margin-top: 5px; }
      table { margin-top: 20px; border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    </style>
  </head>
  <body>
    <h2>Track Submissions & Commission</h2>
    
    <label for="storeId">Store ID:</label>
    <input type="text" id="storeId" placeholder="e.g., STORE001" />

    <label for="startDate">Start Date:</label>
    <input type="date" id="startDate" />

    <label for="endDate">End Date:</label>
    <input type="date" id="endDate" />

    <button onclick="fetchData()">Get Data</button>

    <div id="results"></div>

    <script>
      function fetchData() {
        const storeId = document.getElementById('storeId').value.trim();
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;

        if (!storeId || !startDate || !endDate) {
          alert('Please enter all fields');
          return;
        }

        google.script.run.withSuccessHandler(renderTable)
                         .withFailureHandler(err => alert(err.message))
                         .getTrackingData(storeId, startDate, endDate);
      }

      function renderTable(data) {
        if (!data.length) {
          document.getElementById('results').innerHTML = '<p>No data found.</p>';
          return;
        }

        let html = '<table><tr><th>Date</th><th>Customer</th><th>Commission</th><th>Our Amount</th><th>Total</th></tr>';
        let totalCommission = 0, totalOurAmount = 0, totalTotal = 0;

        data.forEach(row => {
          html += `<tr><td>${row.date}</td><td>${row.customer}</td><td>₹${row.commission}</td><td>₹${row.ourAmount}</td><td>₹${row.total}</td></tr>`;
          totalCommission += row.commission;
          totalOurAmount += row.ourAmount;
          totalTotal += row.total;
        });

        html += `<tr><th colspan="2">Total</th><th>₹${totalCommission}</th><th>₹${totalOurAmount}</th><th>₹${totalTotal}</th></tr>`;
        html += '</table>';

        document.getElementById('results').innerHTML = html;
      }
    </script>
  </body>
</html>
